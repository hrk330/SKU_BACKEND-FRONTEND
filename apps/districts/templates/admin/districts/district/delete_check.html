{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:districts_district_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="delete-confirmation">
    <h1>{{ title }}</h1>
    
    <div class="district-info" style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0;">
        <h2>District Information</h2>
        <table>
            <tr><td><strong>Name:</strong></td><td>{{ district.name }}</td></tr>
            <tr><td><strong>Code:</strong></td><td>{{ district.code }}</td></tr>
            <tr><td><strong>Full Path:</strong></td><td>{{ district.full_path }}</td></tr>
            <tr><td><strong>Level:</strong></td><td>{{ district.level }}</td></tr>
            <tr><td><strong>Status:</strong></td><td>
                {% if district.is_active %}
                    <span style="color: green;">‚úì Active</span>
                {% else %}
                    <span style="color: red;">‚úó Inactive</span>
                {% endif %}
            </td></tr>
        </table>
    </div>

    <div class="deletion-status" style="background: {% if summary.can_delete %}{% if summary.affected_objects %}#fff3cd{% else %}#d4edda{% endif %}{% else %}#f8d7da{% endif %}; padding: 20px; border-radius: 5px; margin: 20px 0; border: 1px solid {% if summary.can_delete %}{% if summary.affected_objects %}#ffeaa7{% else %}#c3e6cb{% endif %}{% else %}#f5c6cb{% endif %};">
        <h2>
            {% if summary.can_delete %}
                {% if summary.affected_objects %}
                    ‚ö†Ô∏è Deletion Impact Analysis
                {% else %}
                    ‚úÖ Safe to Delete
                {% endif %}
            {% else %}
                ‚ùå Cannot Delete
            {% endif %}
        </h2>
        
        <p><strong>Status:</strong> {{ summary.reason }}</p>
        
        {% if summary.affected_objects %}
            <h3>Objects that will be affected:</h3>
            <ul>
                {% for object_type, count in summary.affected_objects.items %}
                    <li>
                        <strong>
                            {% if object_type == 'child_districts' %}Child Districts
                            {% elif object_type == 'reference_prices' %}Reference Prices
                            {% elif object_type == 'price_audits' %}Price Audits
                            {% else %}{{ object_type|title }}{% endif %}:
                        </strong> {{ count }}
                        {% if object_type == 'retailers' %}
                            <span style="color: red;">(This prevents deletion!)</span>
                        {% elif object_type == 'child_districts' %}
                            <span style="color: orange;">(Will be deleted)</span>
                        {% else %}
                            <span style="color: orange;">(Will be deleted)</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    {% if summary.can_delete %}
        <div class="deletion-warning" style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0; border: 1px solid #ffeaa7;">
            <h3>‚ö†Ô∏è Important Warning</h3>
            <p>Deleting this district will permanently remove:</p>
            <ul>
                <li>The district itself</li>
                {% if summary.affected_objects.child_districts %}
                    <li>{{ summary.affected_objects.child_districts }} child district(s)</li>
                {% endif %}
                {% if summary.affected_objects.reference_prices %}
                    <li>{{ summary.affected_objects.reference_prices }} reference price(s)</li>
                {% endif %}
                {% if summary.affected_objects.complaints %}
                    <li>{{ summary.affected_objects.complaints }} complaint(s)</li>
                {% endif %}
                {% if summary.affected_objects.price_audits %}
                    <li>{{ summary.affected_objects.price_audits }} price audit(s)</li>
                {% endif %}
            </ul>
            <p><strong>This action cannot be undone!</strong></p>
        </div>

        <div class="deletion-actions" style="margin: 30px 0;">
            <form method="post" action="{% url 'admin:districts_district_safe_delete' district.pk %}" style="display: inline;">
                {% csrf_token %}
                <input type="submit" value="üóëÔ∏è Delete District" 
                       style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;"
                       onclick="return confirm('Are you absolutely sure you want to delete this district and all related data? This action cannot be undone!');">
            </form>
            
            <a href="{% url 'admin:districts_district_changelist' %}" 
               style="background: #6c757d; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; margin-left: 10px; display: inline-block;">
                Cancel
            </a>
        </div>
    {% else %}
        <div class="cannot-delete" style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 20px 0; border: 1px solid #f5c6cb;">
            <h3>‚ùå Cannot Delete District</h3>
            <p>This district cannot be deleted because it has active retailers. You must first:</p>
            <ul>
                <li>Move or delete all retailers in this district</li>
                <li>Or reassign them to a different district</li>
            </ul>
        </div>

        <div class="actions" style="margin: 30px 0;">
            <a href="{% url 'admin:districts_district_changelist' %}" 
               style="background: #6c757d; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; display: inline-block;">
                Back to Districts List
            </a>
        </div>
    {% endif %}
</div>

<style>
.district-info table {
    width: 100%;
    border-collapse: collapse;
}
.district-info td {
    padding: 8px 0;
    border-bottom: 1px solid #dee2e6;
}
.district-info td:first-child {
    width: 150px;
    font-weight: bold;
}
.deletion-status h2 {
    margin-top: 0;
}
.deletion-status ul {
    margin: 10px 0;
    padding-left: 20px;
}
.deletion-warning ul {
    margin: 10px 0;
    padding-left: 20px;
}
.cannot-delete ul {
    margin: 10px 0;
    padding-left: 20px;
}
</style>
{% endblock %}
